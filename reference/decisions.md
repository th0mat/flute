# decisions for flute

### paths and dirs

* dirs like appDir and userDir end with '/'
* appDir: used for all that will be replaced with a new version
* userDir: created during first installation, outside app dir (~/Liberary/MagicFlute/v_0_0_1/)
* imgBank is just the total of all pics in user/img, not a speparate dir (std flute pix to have prefix to show them after all the user defined pix)

### database vs json

* keep traffic data in sqlite (generated by c++ code)
* keep targets data in json (generated by node)


### activityLog.json logging

* keep log data in json format {lastLog: ts, activities: [{}, {}...]}
* keep sysUp and sysDown events as activities
* activities: {ts: ..., mac: "", name: "sys up|sys down" , prez: bool}
* load activityLog.json at startup
* run updateActivityLog() at start-up and then 1/min
* static field for isStartup bool
* keep JSON in memory, but save after each update


### component state vs redux vs remote.getGlobal('sharedObj')

* use redux for state only when cross-module communication requires it, else use component state
* appDir, userDir, logger, mfuid are properties of remote.getGlobal('sharedObj')


### loading sequence

* appDir, userDir @ sharedObj in main.development.js
* logger @ sharedObj in main.development.js
* sysConfig @ sharedObj in main.development.js (fail: ask to reinstall)
* userConfig @ sharedObj in main.development.js (fail: reset default, resetConfig: true)
* ---- new BrowserWindow
* appDir, userDir, userConfig @ store in index from 'sharedObj'
* targets, oui, imgBank @ store in index from fs
* notifier @ store in index from new
* updateActivityLog() @ store in index;
* updateInternetStatus() @ store in index;




### exception and error handling

* sysConfig: fail, propose to reinstall
* userConfig: create new userConfig.json file based on default config included in sysConfig.json, quit and ask for restart
* targets: ignore and assume non habe been set
* flengine comm: keep as pending and send when connection is back 
* no try/catch for JSON.parse(JSON.stringify...)

### logging

* logger loaded via main process and then shared with renderer process

### installer tasks

* sudo spctl --master-disable // to disable gatekeeper or ask user to control-click-open when starting the first time
* sudo chown root pap_* (find . -user root)
* sudo chmod u+s pap_*  (find . -perm +4000)
* copy a userConfig.json file to userDir
