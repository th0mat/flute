/*
 * Copyright 2016 Palantir Technologies, Inc. All rights reserved.
 * Licensed under the BSD-3 License as modified (the “License”); you may obtain a copy
 * of the license at https://github.com/palantir/blueprint/blob/master/LICENSE
 * and https://github.com/palantir/blueprint/blob/master/PATENTS
 */
"use strict";
var React = require("react");
var utils_1 = require("../../common/utils");
var hotkeysEvents_1 = require("./hotkeysEvents");
function HotkeysTarget(constructor) {
    var _a = constructor.prototype, componentWillMount = _a.componentWillMount, componentDidMount = _a.componentDidMount, componentWillUnmount = _a.componentWillUnmount, render = _a.render, renderHotkeys = _a.renderHotkeys;
    if (!utils_1.isFunction(renderHotkeys)) {
        throw new Error("@HotkeysTarget-decorated class must implement `renderHotkeys`. " + constructor);
    }
    // tslint:disable no-invalid-this only-arrow-functions
    constructor.prototype.componentWillMount = function () {
        this.localHotkeysEvents = new hotkeysEvents_1.HotkeysEvents(hotkeysEvents_1.HotkeyScope.LOCAL);
        this.globalHotkeysEvents = new hotkeysEvents_1.HotkeysEvents(hotkeysEvents_1.HotkeyScope.GLOBAL);
        if (componentWillMount != null) {
            componentWillMount.call(this);
        }
    };
    constructor.prototype.componentDidMount = function () {
        // attach global key event listeners
        document.addEventListener("keydown", this.globalHotkeysEvents.handleKeyDown);
        document.addEventListener("keyup", this.globalHotkeysEvents.handleKeyUp);
        if (componentDidMount != null) {
            componentDidMount.call(this);
        }
    };
    constructor.prototype.componentWillUnmount = function () {
        // detach global key event listeners
        document.removeEventListener("keydown", this.globalHotkeysEvents.handleKeyDown);
        document.removeEventListener("keyup", this.globalHotkeysEvents.handleKeyUp);
        this.globalHotkeysEvents.clear();
        this.localHotkeysEvents.clear();
        if (componentWillUnmount != null) {
            componentWillUnmount.call(this);
        }
    };
    constructor.prototype.render = function () {
        var _this = this;
        var element = render.call(this);
        var hotkeys = renderHotkeys.call(this);
        this.localHotkeysEvents.setHotkeys(hotkeys.props);
        this.globalHotkeysEvents.setHotkeys(hotkeys.props);
        // attach local key event listeners
        if (element != null && this.localHotkeysEvents.count() > 0) {
            var tabIndex = hotkeys.props.tabIndex === undefined ? 0 : hotkeys.props.tabIndex;
            var existingKeyDown_1 = element.props.onKeyDown;
            var onKeyDown = function (e) {
                _this.localHotkeysEvents.handleKeyDown(e.nativeEvent);
                utils_1.safeInvoke(existingKeyDown_1, e);
            };
            var existingKeyUp_1 = element.props.onKeyUp;
            var onKeyUp = function (e) {
                _this.localHotkeysEvents.handleKeyUp(e.nativeEvent);
                utils_1.safeInvoke(existingKeyUp_1, e);
            };
            return React.cloneElement(element, { tabIndex: tabIndex, onKeyDown: onKeyDown, onKeyUp: onKeyUp });
        }
        else {
            return element;
        }
    };
    // tslint:enable
}
exports.HotkeysTarget = HotkeysTarget;
;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb21wb25lbnRzL2hvdGtleXMvaG90a2V5c1RhcmdldC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7O0dBS0c7O0FBRUgsSUFBWSxLQUFLLFdBQU0sT0FBTyxDQUFDLENBQUE7QUFDL0Isc0JBQXVDLG9CQUFvQixDQUFDLENBQUE7QUFHNUQsOEJBQTJDLGlCQUFpQixDQUFDLENBQUE7QUFnQjdELHVCQUF1RSxXQUFjO0lBQ2pGLElBQUEsMEJBTXlCLEVBTHJCLDBDQUFrQixFQUNsQix3Q0FBaUIsRUFDakIsOENBQW9CLEVBQ3BCLGtCQUFNLEVBQ04sZ0NBQWEsQ0FDUztJQUUxQixFQUFFLENBQUMsQ0FBQyxDQUFDLGtCQUFVLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzdCLE1BQU0sSUFBSSxLQUFLLENBQUMsb0VBQW9FLFdBQWEsQ0FBQyxDQUFDO0lBQ3ZHLENBQUM7SUFFRCxzREFBc0Q7SUFDdEQsV0FBVyxDQUFDLFNBQVMsQ0FBQyxrQkFBa0IsR0FBRztRQUN2QyxJQUFJLENBQUMsa0JBQWtCLEdBQUcsSUFBSSw2QkFBYSxDQUFDLDJCQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDL0QsSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksNkJBQWEsQ0FBQywyQkFBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRWpFLEVBQUUsQ0FBQyxDQUFDLGtCQUFrQixJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDN0Isa0JBQWtCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2xDLENBQUM7SUFDTCxDQUFDLENBQUM7SUFFRixXQUFXLENBQUMsU0FBUyxDQUFDLGlCQUFpQixHQUFHO1FBQ3RDLG9DQUFvQztRQUNwQyxRQUFRLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUM3RSxRQUFRLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUV6RSxFQUFFLENBQUMsQ0FBQyxpQkFBaUIsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQzVCLGlCQUFpQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNqQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDO0lBRUYsV0FBVyxDQUFDLFNBQVMsQ0FBQyxvQkFBb0IsR0FBRztRQUN6QyxvQ0FBb0M7UUFDcEMsUUFBUSxDQUFDLG1CQUFtQixDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsbUJBQW1CLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDaEYsUUFBUSxDQUFDLG1CQUFtQixDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsbUJBQW1CLENBQUMsV0FBVyxDQUFDLENBQUM7UUFFNUUsSUFBSSxDQUFDLG1CQUFtQixDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ2pDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUVoQyxFQUFFLENBQUMsQ0FBQyxvQkFBb0IsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQy9CLG9CQUFvQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNwQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDO0lBRUYsV0FBVyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEdBQUc7UUFBQSxpQkEwQjlCO1FBekJHLElBQU0sT0FBTyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFnQixDQUFDO1FBRWpELElBQU0sT0FBTyxHQUFHLGFBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDekMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDbEQsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7UUFFbkQsbUNBQW1DO1FBQ25DLEVBQUUsQ0FBQyxDQUFDLE9BQU8sSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLGtCQUFrQixDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDekQsSUFBTSxRQUFRLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxRQUFRLEtBQUssU0FBUyxHQUFHLENBQUMsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQztZQUVuRixJQUFNLGlCQUFlLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxTQUFvRCxDQUFDO1lBQzNGLElBQU0sU0FBUyxHQUFHLFVBQUMsQ0FBbUM7Z0JBQ2xELEtBQUksQ0FBQyxrQkFBa0IsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLFdBQTRCLENBQUMsQ0FBQztnQkFDdEUsa0JBQVUsQ0FBQyxpQkFBZSxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ25DLENBQUMsQ0FBQztZQUVGLElBQU0sZUFBYSxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsT0FBa0QsQ0FBQztZQUN2RixJQUFNLE9BQU8sR0FBRyxVQUFDLENBQW1DO2dCQUNoRCxLQUFJLENBQUMsa0JBQWtCLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxXQUE0QixDQUFDLENBQUM7Z0JBQ3BFLGtCQUFVLENBQUMsZUFBYSxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ2pDLENBQUMsQ0FBQztZQUNGLE1BQU0sQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxFQUFFLGtCQUFRLEVBQUUsb0JBQVMsRUFBRSxnQkFBTyxFQUFFLENBQUMsQ0FBQztRQUN6RSxDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDSixNQUFNLENBQUMsT0FBTyxDQUFDO1FBQ25CLENBQUM7SUFDTCxDQUFDLENBQUM7SUFDRixnQkFBZ0I7QUFDcEIsQ0FBQztBQTFFZSxxQkFBYSxnQkEwRTVCLENBQUE7QUFBQSxDQUFDIiwiZmlsZSI6ImNvbXBvbmVudHMvaG90a2V5cy9ob3RrZXlzVGFyZ2V0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAyMDE2IFBhbGFudGlyIFRlY2hub2xvZ2llcywgSW5jLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEJTRC0zIExpY2Vuc2UgYXMgbW9kaWZpZWQgKHRoZSDigJxMaWNlbnNl4oCdKTsgeW91IG1heSBvYnRhaW4gYSBjb3B5XG4gKiBvZiB0aGUgbGljZW5zZSBhdCBodHRwczovL2dpdGh1Yi5jb20vcGFsYW50aXIvYmx1ZXByaW50L2Jsb2IvbWFzdGVyL0xJQ0VOU0VcbiAqIGFuZCBodHRwczovL2dpdGh1Yi5jb20vcGFsYW50aXIvYmx1ZXByaW50L2Jsb2IvbWFzdGVyL1BBVEVOVFNcbiAqL1xuXG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCB7IGlzRnVuY3Rpb24sIHNhZmVJbnZva2UgfSBmcm9tIFwiLi4vLi4vY29tbW9uL3V0aWxzXCI7XG5cbmltcG9ydCB7IElIb3RrZXlzUHJvcHMgfSBmcm9tIFwiLi9ob3RrZXlzXCI7XG5pbXBvcnQgeyBIb3RrZXlTY29wZSwgSG90a2V5c0V2ZW50cyB9IGZyb20gXCIuL2hvdGtleXNFdmVudHNcIjtcblxuZXhwb3J0IGludGVyZmFjZSBJSG90a2V5c1RhcmdldCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxhbnksIGFueT4sIFJlYWN0LkNvbXBvbmVudExpZmVjeWNsZTxhbnksIGFueT4ge1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBnbG9iYWxIb3RrZXlzRXZlbnRzPzogSG90a2V5c0V2ZW50cztcblxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBsb2NhbEhvdGtleXNFdmVudHM/OiBIb3RrZXlzRXZlbnRzO1xuXG4gICAgLyoqXG4gICAgICogQ29tcG9uZW50cyBkZWNvcmF0ZWQgd2l0aCB0aGUgYEhvdGtleXNUYXJnZXRgIGRlY29yYXRvciBtdXN0IGltcGxlbWVudFxuICAgICAqIHRoaXMgbWV0aG9kLCBhbmQgaXQgbXVzdCByZXR1cm4gYSBgSG90a2V5c2AgUmVhY3QgZWxlbWVudC5cbiAgICAgKi9cbiAgICByZW5kZXJIb3RrZXlzKCk6IFJlYWN0LlJlYWN0RWxlbWVudDxJSG90a2V5c1Byb3BzPjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIEhvdGtleXNUYXJnZXQ8VCBleHRlbmRzIHsgcHJvdG90eXBlOiBJSG90a2V5c1RhcmdldCB9Pihjb25zdHJ1Y3RvcjogVCkge1xuICAgIGNvbnN0IHtcbiAgICAgICAgY29tcG9uZW50V2lsbE1vdW50LFxuICAgICAgICBjb21wb25lbnREaWRNb3VudCxcbiAgICAgICAgY29tcG9uZW50V2lsbFVubW91bnQsXG4gICAgICAgIHJlbmRlcixcbiAgICAgICAgcmVuZGVySG90a2V5cyxcbiAgICB9ID0gY29uc3RydWN0b3IucHJvdG90eXBlO1xuXG4gICAgaWYgKCFpc0Z1bmN0aW9uKHJlbmRlckhvdGtleXMpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQEhvdGtleXNUYXJnZXQtZGVjb3JhdGVkIGNsYXNzIG11c3QgaW1wbGVtZW50IFxcYHJlbmRlckhvdGtleXNcXGAuICR7Y29uc3RydWN0b3J9YCk7XG4gICAgfVxuXG4gICAgLy8gdHNsaW50OmRpc2FibGUgbm8taW52YWxpZC10aGlzIG9ubHktYXJyb3ctZnVuY3Rpb25zXG4gICAgY29uc3RydWN0b3IucHJvdG90eXBlLmNvbXBvbmVudFdpbGxNb3VudCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmxvY2FsSG90a2V5c0V2ZW50cyA9IG5ldyBIb3RrZXlzRXZlbnRzKEhvdGtleVNjb3BlLkxPQ0FMKTtcbiAgICAgICAgdGhpcy5nbG9iYWxIb3RrZXlzRXZlbnRzID0gbmV3IEhvdGtleXNFdmVudHMoSG90a2V5U2NvcGUuR0xPQkFMKTtcblxuICAgICAgICBpZiAoY29tcG9uZW50V2lsbE1vdW50ICE9IG51bGwpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudFdpbGxNb3VudC5jYWxsKHRoaXMpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGNvbnN0cnVjdG9yLnByb3RvdHlwZS5jb21wb25lbnREaWRNb3VudCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBhdHRhY2ggZ2xvYmFsIGtleSBldmVudCBsaXN0ZW5lcnNcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5nbG9iYWxIb3RrZXlzRXZlbnRzLmhhbmRsZUtleURvd24pO1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5nbG9iYWxIb3RrZXlzRXZlbnRzLmhhbmRsZUtleVVwKTtcblxuICAgICAgICBpZiAoY29tcG9uZW50RGlkTW91bnQgIT0gbnVsbCkge1xuICAgICAgICAgICAgY29tcG9uZW50RGlkTW91bnQuY2FsbCh0aGlzKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBjb25zdHJ1Y3Rvci5wcm90b3R5cGUuY29tcG9uZW50V2lsbFVubW91bnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gZGV0YWNoIGdsb2JhbCBrZXkgZXZlbnQgbGlzdGVuZXJzXG4gICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuZ2xvYmFsSG90a2V5c0V2ZW50cy5oYW5kbGVLZXlEb3duKTtcbiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIHRoaXMuZ2xvYmFsSG90a2V5c0V2ZW50cy5oYW5kbGVLZXlVcCk7XG5cbiAgICAgICAgdGhpcy5nbG9iYWxIb3RrZXlzRXZlbnRzLmNsZWFyKCk7XG4gICAgICAgIHRoaXMubG9jYWxIb3RrZXlzRXZlbnRzLmNsZWFyKCk7XG5cbiAgICAgICAgaWYgKGNvbXBvbmVudFdpbGxVbm1vdW50ICE9IG51bGwpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudFdpbGxVbm1vdW50LmNhbGwodGhpcyk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgY29uc3RydWN0b3IucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBjb25zdCBlbGVtZW50ID0gcmVuZGVyLmNhbGwodGhpcykgYXMgSlNYLkVsZW1lbnQ7XG5cbiAgICAgICAgY29uc3QgaG90a2V5cyA9IHJlbmRlckhvdGtleXMuY2FsbCh0aGlzKTtcbiAgICAgICAgdGhpcy5sb2NhbEhvdGtleXNFdmVudHMuc2V0SG90a2V5cyhob3RrZXlzLnByb3BzKTtcbiAgICAgICAgdGhpcy5nbG9iYWxIb3RrZXlzRXZlbnRzLnNldEhvdGtleXMoaG90a2V5cy5wcm9wcyk7XG5cbiAgICAgICAgLy8gYXR0YWNoIGxvY2FsIGtleSBldmVudCBsaXN0ZW5lcnNcbiAgICAgICAgaWYgKGVsZW1lbnQgIT0gbnVsbCAmJiB0aGlzLmxvY2FsSG90a2V5c0V2ZW50cy5jb3VudCgpID4gMCkge1xuICAgICAgICAgICAgY29uc3QgdGFiSW5kZXggPSBob3RrZXlzLnByb3BzLnRhYkluZGV4ID09PSB1bmRlZmluZWQgPyAwIDogaG90a2V5cy5wcm9wcy50YWJJbmRleDtcblxuICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdLZXlEb3duID0gZWxlbWVudC5wcm9wcy5vbktleURvd24gYXMgUmVhY3QuS2V5Ym9hcmRFdmVudEhhbmRsZXI8SFRNTEVsZW1lbnQ+O1xuICAgICAgICAgICAgY29uc3Qgb25LZXlEb3duID0gKGU6IFJlYWN0LktleWJvYXJkRXZlbnQ8SFRNTEVsZW1lbnQ+KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2NhbEhvdGtleXNFdmVudHMuaGFuZGxlS2V5RG93bihlLm5hdGl2ZUV2ZW50IGFzIEtleWJvYXJkRXZlbnQpO1xuICAgICAgICAgICAgICAgIHNhZmVJbnZva2UoZXhpc3RpbmdLZXlEb3duLCBlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nS2V5VXAgPSBlbGVtZW50LnByb3BzLm9uS2V5VXAgYXMgUmVhY3QuS2V5Ym9hcmRFdmVudEhhbmRsZXI8SFRNTEVsZW1lbnQ+O1xuICAgICAgICAgICAgY29uc3Qgb25LZXlVcCA9IChlOiBSZWFjdC5LZXlib2FyZEV2ZW50PEhUTUxFbGVtZW50PikgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubG9jYWxIb3RrZXlzRXZlbnRzLmhhbmRsZUtleVVwKGUubmF0aXZlRXZlbnQgYXMgS2V5Ym9hcmRFdmVudCk7XG4gICAgICAgICAgICAgICAgc2FmZUludm9rZShleGlzdGluZ0tleVVwLCBlKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4gUmVhY3QuY2xvbmVFbGVtZW50KGVsZW1lbnQsIHsgdGFiSW5kZXgsIG9uS2V5RG93biwgb25LZXlVcCB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICB9XG4gICAgfTtcbiAgICAvLyB0c2xpbnQ6ZW5hYmxlXG59O1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
